<!DOCTYPE html>
<html lang="zh-Hans">
<head>
    <meta charset="utf-8">
    <title>申请人影像资料上传</title>
    <script src="Content/viewer/jquery.min.js"></script>

    <script src="Content/viewer/viewer.min.js"></script>
    <link rel="stylesheet" href="Content/viewer/viewer.min.css">

    <script src="Content/easyui/jquery.easyui.js"></script>
    <script src="Content/easyui/locale/easyui-lang-zh_CN.js"></script>
    <link href="Content/easyui/themes/bootstrap/easyui.css" rel="stylesheet" />
    <script src="Content/uploadify/jquery.uploadify.js"></script>
    <link href="Content/uploadify/uploadify.css" rel="stylesheet" />

    <script src="Content/viewerUpload/uploadFile.js"></script>
    <script src="Content/viewerUpload/PictureViewer.js"></script>
    <script src="Content/FinanceJs.js"></script>

    <link href="../Content/easyui/themes/bootstrap/easyui.css" rel="stylesheet" />
    <link href="../Content/easyui/themes/icon.css" rel="stylesheet" />
    <link href="../Content/form-bootstrap.css" rel="stylesheet" />

    <style type="text/css">
        div#viewerContainer div {
            float: left;
        }

        img {
            width: 100px;
            height: 100px;
        }

        div#AddPic div img {
            width: 100px;
            height: 100px;
        }
    </style>

    <script type="text/javascript">
        var query = {};

        // 融资标识
        var referenceId = "EEEEEEEE-EEEE-EEEE-EEEE-EEEEEEEEEE00";

        // 表单（申请人）
        var referenceType = 1;

        // 分组
        var referenceSid = "EEEEEEEE-EEEE-EEEE-EEEE-EEEEEEEEEE00";

        var flag = "EEEEEEEE-EEEE-EEEE-EEEE-EEEEEEEEEE";

        $(function () {
            // 初始化
            Init();
        });

        function Init()
        {
            $("input[type=checkbox]:checked").each(function (i, e) {
                e.checked = false;
            });

            // 获取参数
            query.state = GetQueryString("state");
            query.FinanceId = parent.flow.RootKey;

            referenceId = query.FinanceId;

            if (query.state == '0')
            {
                $("a#del").linkbutton('disable');
            }

            var value = {};
            value.referenceId = referenceId;
            value.referenceType = referenceType;
            value.referenceSid = null;

            LoadAllFiles(value);
        }

        function Delete() {
            var referenceSids = [];

            $("fieldset input[type=checkbox]:checked").each(function (i, e) {
                var id = $(e).parent().next("div").attr("id");

                referenceSids.push(flag + id.substr(id.lastIndexOf('_') + 1));

                // 移除图片预览
                $("div#" + id).find("div#li").remove();
            });

            DeleteFiles(referenceId, referenceType, referenceSids);
        }

        function DownLoadAll() {
            $("form#downloadForm").find("input[name=ReferenceId]").val(referenceId);

            $("fieldset input[type=checkbox]:checked").each(function (i, e) {
                var id = $(e).parent().next("div").attr("id");

                var referenceSid = flag + id.substr(id.lastIndexOf('_') + 1);

                $("form#downloadForm").append('<input name="referenceSids" value=' + referenceSid + ' />');
            });

            $("form#downloadForm").submit();

            $("form#downloadForm").find("input[name=referenceSids]").remove();
        }

        function CheckAll(obj) {
            debugger
            $("fieldset input[type=checkbox]").each(function (i, e) {
                e.checked = obj.checked;
            })
        }
    </script>

    <script type="text/javascript">
        $(function () {
            jsPicViewerUploderInit();
        });

        function jsPicViewerUploderInit() {
            setTimeout(function () {
                // 实例化图片查看器
                viewer = InitPicViewer($("div#viewerContainer_11"));

                if (query.state != '0')
                {
                    $("div#AddPic img").click(function () {
                        $("#dd_upload").dialog({ top: $(document).scrollTop() + 300 }).dialog("open");

                        // 设置分组标识
                        referenceSid = flag + $("form").attr('tag');

                        // 启动文件上传
                        StartUploader(referenceId, referenceType, referenceSid);
                    });
                }
            }, 100);
        }

        // 图片上传成功回调函数
        function UploadSuccessInstance(file, data, response) {
            data = JSON.parse(data);

            var files = GetFiles(data.referenceId, data.referenceType, data.referenceSid);

            if (files == null || files.length == 0) {
                return false;
            }

            var UrlArray = [];
            
            for (var i in files) {
                var urlObj = {};
                urlObj.Name = files[i].Name;
                urlObj.Path = files[i].Path;

                UrlArray.push(urlObj);
            }
            
            // 上传的图片加入viewer
            PicViewerLoadPic(UrlArray, $("div#viewerContainer_" + $("form").attr("tag")));
        }
    </script>
</head>
<body>
    <form class="container" tag="11">
        <div id="linkBtn">
            <div id="fieldsetBtn">
                <div style="float:left;width:700px;height:25px;">
                    <a id="del" class="easyui-linkbutton" href="javascript:void(0)" data-options="onClick:Delete,width:100">删除</a>
                    <a id="downloadall" class="easyui-linkbutton" href="javascript:void(0)" data-options="onClick:DownLoadAll,width:100">下载全部</a>
                </div>
                <div style="width:200px;height:25px; padding-top:40px;">
                    <input id="cball" style="float:left;width:30px " name="cball" type="checkbox" class="easyui-validatebox" onclick="CheckAll(this)">
                    <label for="cball" style="width:30px;margin-top:2px;">全选</label>
                </div>
            </div>
        </div>

        <fieldset class="" style="float:none">
            <legend>身份类</legend>
            <div class="container" style="">
                <label style="font-size:17px"><input type="checkbox" /><span>客户融资申请表:</span></label>
                <div id="viewerContainer_11">
                </div>
                <div>
                    <div id="AddPic">
                        <div><img data-original="Content/img/田型图片.png" src="Content/img/田型图片.png" onclick="$('form').attr('tag',11)" /></div>
                    </div>
                </div>
                <div style="width:auto;height:18px"></div>
                <hr style="border:1px dashed;margin-bottom:20px" />
            </div>

            <div class="container" style="">
                <label style="font-size:17px"><input type="checkbox"><span>单身证明:</span></label>
                <div id="viewerContainer_12">
                </div>
                <div>
                    <div id="AddPic">
                        <div><img data-original="Content/img/田型图片.png" src="Content/img/田型图片.png" onclick="$('form').attr('tag',12)" /></div>
                    </div>
                </div>
                <div style="width:auto;height:18px"></div>
                <hr style="border:1px dashed ;" />
            </div>

            <div class="container" style="">
                <label style="font-size:17px"><input type="checkbox"><span>其它:</span></label>
                <div id="viewerContainer_13">
                </div>
                <div>
                    <div id="AddPic">
                        <div><img data-original="Content/img/田型图片.png" src="Content/img/田型图片.png" onclick="$('form').attr('tag',13)" /></div>
                    </div>
                </div>
                <div style="width:auto;height:18px"></div>
                <hr style="border:1px dashed ;" />
            </div>
        </fieldset>

        <fieldset class="" style="float:none">
            <legend>车辆类</legend>
            <div class="container" style="">
                <label style="font-size:17px"><input type="checkbox"><span>车辆登记证书:</span></label>
                <div id="viewerContainer_21">
                </div>
                <div>
                    <div id="AddPic">
                        <div><img data-original="Content/img/田型图片.png" src="Content/img/田型图片.png" onclick="$('form').attr('tag',21)" /></div>
                    </div>
                </div>
                <div style="width:auto;height:18px"></div>
                <hr style="border:1px dashed;margin-bottom:20px" />
            </div>

            <div class="container" style="">
                <label style="font-size:17px"><input type="checkbox"><span>车辆行驶证:</span></label>
                <div id="viewerContainer_22">
                </div>
                <div>
                    <div id="AddPic">
                        <div><img data-original="Content/img/田型图片.png" src="Content/img/田型图片.png" onclick="$('form').attr('tag',22)" /></div>
                    </div>
                </div>
                <div style="width:auto;height:18px"></div>
                <hr style="border:1px dashed ;" />
            </div>

            <div class="container" style="">
                <label style="font-size:17px"><input type="checkbox"><span>车辆照片:</span></label>
                <div id="viewerContainer_23">
                </div>
                <div>
                    <div id="AddPic">
                        <div><img data-original="Content/img/田型图片.png" src="Content/img/田型图片.png" onclick="$('form').attr('tag',23)" /></div>
                    </div>
                </div>
                <div style="width:auto;height:18px"></div>
                <hr style="border:1px dashed ;" />
            </div>
        </fieldset>

        <fieldset class="" style="float:none">
            <legend>主要申请人</legend>
            <div class="container" style="">
                <label style="font-size:17px"><input type="checkbox"><span>身份证正反面:</span></label>
                <div id="viewerContainer_31">
                </div>
                <div>
                    <div id="AddPic">
                        <div><img data-original="Content/img/田型图片.png" src="Content/img/田型图片.png" onclick="$('form').attr('tag',31)" /></div>
                    </div>
                </div>
                <div style="width:auto;height:18px"></div>
                <hr style="border:1px dashed;margin-bottom:20px" />
            </div>

            <div class="container" style="">
                <label style="font-size:17px"><input type="checkbox"><span>户口本复印件:</span></label>
                <div id="viewerContainer_32">
                </div>
                <div>
                    <div id="AddPic">
                        <div><img data-original="Content/img/田型图片.png" src="Content/img/田型图片.png" onclick="$('form').attr('tag',32)" /></div>
                    </div>
                </div>
                <div style="width:auto;height:18px"></div>
                <hr style="border:1px dashed ;" />
            </div>

            <div class="container" style="">
                <label style="font-size:17px"><input type="checkbox"><span>结婚证/未婚承诺书:</span></label>
                <div id="viewerContainer_33">
                </div>
                <div>
                    <div id="AddPic">
                        <div><img data-original="Content/img/田型图片.png" src="Content/img/田型图片.png" onclick="$('form').attr('tag',33)" /></div>
                    </div>
                </div>
                <div style="width:auto;height:18px"></div>
                <hr style="border:1px dashed ;" />
            </div>

            <div class="container" style="">
                <label style="font-size:17px"><input type="checkbox"><span>驾驶证:</span></label>
                <div id="viewerContainer_34">
                </div>
                <div>
                    <div id="AddPic">
                        <div><img data-original="Content/img/田型图片.png" src="Content/img/田型图片.png" onclick="$('form').attr('tag',34)" /></div>
                    </div>
                </div>
                <div style="width:auto;height:18px"></div>
                <hr style="border:1px dashed ;" />
            </div>

            <div class="container" style="">
                <label style="font-size:17px"><input type="checkbox"><span>居住证明:</span></label>
                <div id="viewerContainer_35">
                </div>
                <div>
                    <div id="AddPic">
                        <div><img data-original="Content/img/田型图片.png" src="Content/img/田型图片.png" onclick="$('form').attr('tag',35)" /></div>
                    </div>
                </div>
                <div style="width:auto;height:18px"></div>
                <hr style="border:1px dashed ;" />
            </div>

            <div class="container" style="">
                <label style="font-size:17px"><input type="checkbox"><span>家访照片:</span></label>
                <div id="viewerContainer_36">
                </div>
                <div>
                    <div id="AddPic">
                        <div><img data-original="Content/img/田型图片.png" src="Content/img/田型图片.png" onclick="$('form').attr('tag',36)" /></div>
                    </div>
                </div>
                <div style="width:auto;height:18px"></div>
                <hr style="border:1px dashed ;" />
            </div>

            <div class="container" style="">
                <label style="font-size:17px"><input type="checkbox"><span>银行流水:</span></label>
                <div id="viewerContainer_37">
                </div>
                <div>
                    <div id="AddPic">
                        <div><img data-original="Content/img/田型图片.png" src="Content/img/田型图片.png" onclick="$('form').attr('tag',37)" /></div>
                    </div>
                </div>
                <div style="width:auto;height:18px"></div>
                <hr style="border:1px dashed ;" />
            </div>

            <div class="container" style="">
                <label style="font-size:17px"><input type="checkbox"><span>征信报告:</span></label>
                <div id="viewerContainer_38">
                </div>
                <div>
                    <div id="AddPic">
                        <div><img data-original="Content/img/田型图片.png" src="Content/img/田型图片.png" onclick="$('form').attr('tag',38)" /></div>
                    </div>
                </div>
                <div style="width:auto;height:18px"></div>
                <hr style="border:1px dashed ;" />
            </div>

            <div class="container" style="">
                <label style="font-size:17px"><input type="checkbox"><span>客户其他资信证明:</span></label>
                <div id="viewerContainer_39">
                </div>
                <div>
                    <div id="AddPic">
                        <div><img data-original="Content/img/田型图片.png" src="Content/img/田型图片.png" onclick="$('form').attr('tag',39)" /></div>
                    </div>
                </div>
                <div style="width:auto;height:18px"></div>
                <hr style="border:1px dashed ;" />
            </div>
        </fieldset>

        <fieldset class="" style="float:none">
            <legend>共同申请人</legend>
            <div class="container" style="">
                <label style="font-size:17px"><input type="checkbox"><span>身份证正反面:</span></label>
                <div id="viewerContainer_41">
                </div>
                <div>
                    <div id="AddPic">
                        <div><img data-original="Content/img/田型图片.png" src="Content/img/田型图片.png" onclick="$('form').attr('tag',41)" /></div>
                    </div>
                </div>
                <div style="width:auto;height:18px"></div>
                <hr style="border:1px dashed;margin-bottom:20px" />
            </div>

            <div class="container" style="">
                <label style="font-size:17px"><input type="checkbox"><span>户口本复印件:</span></label>
                <div id="viewerContainer_42">
                </div>
                <div>
                    <div id="AddPic">
                        <div><img data-original="Content/img/田型图片.png" src="Content/img/田型图片.png" onclick="$('form').attr('tag',42)" /></div>
                    </div>
                </div>
                <div style="width:auto;height:18px"></div>
                <hr style="border:1px dashed ;" />
            </div>

            <div class="container" style="">
                <label style="font-size:17px"><input type="checkbox"><span>结婚证/未婚承诺书:</span></label>
                <div id="viewerContainer_43">
                </div>
                <div>
                    <div id="AddPic">
                        <div><img data-original="Content/img/田型图片.png" src="Content/img/田型图片.png" onclick="$('form').attr('tag',43)" /></div>
                    </div>
                </div>
                <div style="width:auto;height:18px"></div>
                <hr style="border:1px dashed ;" />
            </div>

            <div class="container" style="">
                <label style="font-size:17px"><input type="checkbox"><span>驾驶证:</span></label>
                <div id="viewerContainer_44">
                </div>
                <div>
                    <div id="AddPic">
                        <div><img data-original="Content/img/田型图片.png" src="Content/img/田型图片.png" onclick="$('form').attr('tag',44)" /></div>
                    </div>
                </div>
                <div style="width:auto;height:18px"></div>
                <hr style="border:1px dashed ;" />
            </div>

            <div class="container" style="">
                <label style="font-size:17px"><input type="checkbox"><span>居住证明:</span></label>
                <div id="viewerContainer_45">
                </div>
                <div>
                    <div id="AddPic">
                        <div><img data-original="Content/img/田型图片.png" src="Content/img/田型图片.png" onclick="$('form').attr('tag',45)" /></div>
                    </div>
                </div>
                <div style="width:auto;height:18px"></div>
                <hr style="border:1px dashed ;" />
            </div>

            <div class="container" style="">
                <label style="font-size:17px"><input type="checkbox"><span>家访照片:</span></label>
                <div id="viewerContainer_46">
                </div>
                <div>
                    <div id="AddPic">
                        <div><img data-original="Content/img/田型图片.png" src="Content/img/田型图片.png" onclick="$('form').attr('tag',46)" /></div>
                    </div>
                </div>
                <div style="width:auto;height:18px"></div>
                <hr style="border:1px dashed ;" />
            </div>

            <div class="container" style="">
                <label style="font-size:17px"><input type="checkbox"><span>银行流水:</span></label>
                <div id="viewerContainer_47">
                </div>
                <div>
                    <div id="AddPic">
                        <div><img data-original="Content/img/田型图片.png" src="Content/img/田型图片.png" onclick="$('form').attr('tag',47)" /></div>
                    </div>
                </div>
                <div style="width:auto;height:18px"></div>
                <hr style="border:1px dashed ;" />
            </div>

            <div class="container" style="">
                <label style="font-size:17px"><input type="checkbox"><span>征信报告:</span></label>
                <div id="viewerContainer_48">
                </div>
                <div>
                    <div id="AddPic">
                        <div><img data-original="Content/img/田型图片.png" src="Content/img/田型图片.png" onclick="$('form').attr('tag',48)" /></div>
                    </div>
                </div>
                <div style="width:auto;height:18px"></div>
                <hr style="border:1px dashed ;" />
            </div>

            <div class="container" style="">
                <label style="font-size:17px"><input type="checkbox"><span>客户其他资信证明:</span></label>
                <div id="viewerContainer_49">
                </div>
                <div>
                    <div id="AddPic">
                        <div><img data-original="Content/img/田型图片.png" src="Content/img/田型图片.png" onclick="$('form').attr('tag',49)" /></div>
                    </div>
                </div>
                <div style="width:auto;height:18px"></div>
                <hr style="border:1px dashed ;" />
            </div>
        </fieldset>

        <div id="viewerContainer">
            <template id="viewerContainer">
                <div id="li" style="float:left"><img data-original="" src="" alt="" ondblclick="" style="margin-right:30px"><label style="text-align:center;display:block;width:100px;height:20px;word-wrap:break-word;word-break:keep-all;overflow:hidden;"></label></div>
                <div id="AddPic">
                    <div><img data-original="Content/img/田型图片.png" src="Content/img/田型图片.png" ondblclick="" /></div>
                </div>
            </template>
        </div>


        <!--上传控件-->
        <div id="dd_upload" class="easyui-dialog" data-options="title:'上传附件',buttons:'#bb_upload',onClose:uploadFormClose,width:390,height:350,closed:true">
            <div id="file_queue"></div>

            <div id="bb_upload">
                <span id="pic_area">
                    <input type="file" id="pic_upload" name="pic_upload" />
                    <a class="easyui-linkbutton" data-options="width:80" href="javascript:$('#pic_upload').uploadify('upload','*')">开始上传</a>
                </span>
            </div>
        </div>
    </form>

    <div>
        <form id="downloadForm" action="../api/UploadFile/DownloadAllFile" method="POST" style="display:none">
            <input name="ReferenceId" />
            <input name="referenceType" value="1" />
            <!--<input name="referenceSids" />-->
        </form>
    </div>
</body>
</html>